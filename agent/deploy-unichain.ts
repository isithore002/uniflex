// Deploy all contracts to Unichain Sepolia
import { ethers } from 'ethers';
import * as dotenv from 'dotenv';
import * as fs from 'fs';
import * as path from 'path';

dotenv.config({ path: path.resolve(__dirname, '../../.env') });

// Contract ABIs and Bytecodes
const MOCK_TOKEN_ABI = [
  "constructor(string memory name, string memory symbol)",
  "function balanceOf(address) view returns (uint256)",
  "function transfer(address to, uint256 amount) returns (bool)",
  "function approve(address spender, uint256 amount) returns (bool)",
  "function symbol() view returns (string)"
];

// MockToken bytecode (from compiled contract)
const MOCK_TOKEN_BYTECODE = "0x6080604052346103af57610a3180380380610019816103b3565b9283398101906040818303126103af5780516001600160401b0381116103af57826100459183016103d8565b60208201519092906001600160401b0381116103af5761006592016103d8565b81516001600160401b0381116102c257600354600181811c911680156103a5575b60208210146102a457601f8111610342575b50602092601f82116001146102e157928192935f926102d6575b50508160011b915f199060031b1c1916176003555b80516001600160401b0381116102c257600454600181811c911680156102b8575b60208210146102a457601f8111610241575b50602091601f82116001146101e1579181925f926101d6575b50508160011b915f199060031b1c1916176004555b33156101c3576002546b033b2e3c9fd0803ce800000081018091116101af57600255335f525f60205260405f206b033b2e3c9fd0803ce800000081540190556040516b033b2e3c9fd0803ce800000081525f7fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60203393a3604051610607908161042a8239f35b634e487b7160e01b5f52601160045260245ffd5b63ec442f0560e01b5f525f60045260245ffd5b015190505f80610113565b601f1982169260045f52805f20915f5b85811061022957508360019510610211575b505050811b01600455610128565b01515f1960f88460031b161c191690555f8080610203565b919260206001819286850151815501940192016101f1565b60045f527f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b601f830160051c8101916020841061029a575b601f0160051c01905b81811061028f57506100fa565b5f8155600101610282565b9091508190610279565b634e487b7160e01b5f52602260045260245ffd5b90607f16906100e8565b634e487b7160e01b5f52604160045260245ffd5b015190505f806100b2565b601f1982169360035f52805f20915f5b86811061032a5750836001959610610312575b505050811b016003556100c7565b01515f1960f88460031b161c191690555f8080610304565b919260206001819286850151815501940192016102f1565b60035f527fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b601f830160051c8101916020841061039b575b601f0160051c01905b8181106103905750610098565b5f8155600101610383565b909150819061037a565b90607f1690610086565b5f80fd5b6040519190601f01601f191682016001600160401b038111838210176102c257604052565b81601f820112156103af578051906001600160401b0382116102c257610407601f8301601f19166020016103b3565b92828452602083830101116103af57815f9260208093018386015e830101529056fe6080806040526004361015610012575f80fd5b5f3560e01c90816306fdde03146103ef57508063095ea7b31461036d57806318160ddd1461035057806323b872dd14610271578063313ce5671461025657806370a082311461021f57806395d89b4114610104578063a9059cbb146100d35763dd62ed3e1461007f575f80fd5b346100cf5760403660031901126100cf576100986104e8565b6100a06104fe565b6001600160a01b039182165f908152600160209081526040808320949093168252928352819020549051908152f35b5f80fd5b346100cf5760403660031901126100cf576100f96100ef6104e8565b6024359033610514565b602060405160018152f35b346100cf575f3660031901126100cf576040515f6004548060011c90600181168015610215575b602083108114610201578285529081156101e55750600114610190575b50819003601f01601f191681019067ffffffffffffffff82118183101761017c57610178829182604052826104be565b0390f35b634e487b7160e01b5f52604160045260245ffd5b905060045f527f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b5f905b8282106101cf57506020915082010182610148565b60018160209254838588010152019101906101ba565b90506020925060ff191682840152151560051b82010182610148565b634e487b7160e01b5f52602260045260245ffd5b91607f169161012b565b346100cf5760203660031901126100cf576001600160a01b036102406104e8565b165f525f602052602060405f2054604051908152f35b346100cf575f3660031901126100cf57602060405160128152f35b346100cf5760603660031901126100cf5761028a6104e8565b6102926104fe565b6001600160a01b0382165f818152600160209081526040808320338452909152902054909260443592915f1981106102d0575b506100f99350610514565b83811061033557841561032257331561030f576100f9945f52600160205260405f2060018060a01b0333165f526020528360405f2091039055846102c5565b634a1406b160e11b5f525f60045260245ffd5b63e602df0560e01b5f525f60045260245ffd5b8390637dc7a0d960e11b5f523360045260245260445260645ffd5b346100cf575f3660031901126100cf576020600254604051908152f35b346100cf5760403660031901126100cf576103866104e8565b602435903315610322576001600160a01b031690811561030f57335f52600160205260405f20825f526020528060405f20556040519081527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560203392a3602060405160018152f35b346100cf575f3660031901126100cf575f6003548060011c906001811680156104b4575b602083108114610201578285529081156101e5575060011461045f5750819003601f01601f191681019067ffffffffffffffff82118183101761017c57610178829182604052826104be565b905060035f527fc2575a0e9e593c00f959f8c92f12db2869c3395a3b0502d05e2516446f71f85b5f905b82821061049e57506020915082010182610148565b6001816020925483858801015201910190610489565b91607f1691610413565b602060409281835280519182918282860152018484015e5f828201840152601f01601f1916010190565b600435906001600160a01b03821682036100cf57565b602435906001600160a01b03821682036100cf57565b6001600160a01b03169081156105be576001600160a01b03169182156105ab57815f525f60205260405f205481811061059257817fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef92602092855f525f84520360405f2055845f525f825260405f20818154019055604051908152a3565b8263391434e360e21b5f5260045260245260445260645ffd5b63ec442f0560e01b5f525f60045260245ffd5b634b637e8f60e11b5f525f60045260245ffdfea2646970667358221220fc9696f9c3a1fe6bb38e21204ebb6bf923c0e05d802503b58ab5de3cc5a5833664736f6c634300081a0033";

async function main() {
  const rpcUrl = process.env.SEPOLIA_RPC_URL || 'https://sepolia.unichain.org';
  const privateKey = process.env.PRIVATE_KEY;
  
  if (!privateKey) {
    console.error('PRIVATE_KEY not found in .env');
    process.exit(1);
  }

  const provider = new ethers.JsonRpcProvider(rpcUrl);
  const wallet = new ethers.Wallet(privateKey, provider);
  
  console.log('‚ïê'.repeat(60));
  console.log('üöÄ Deploying Contracts to Unichain Sepolia');
  console.log('‚ïê'.repeat(60));
  console.log('Deployer:', wallet.address);
  console.log('Balance:', ethers.formatEther(await provider.getBalance(wallet.address)), 'ETH');
  console.log('');

  // Deploy mETH
  console.log('1Ô∏è‚É£  Deploying mETH...');
  const mETHFactory = new ethers.ContractFactory(
    ["constructor(string memory name, string memory symbol)"],
    MOCK_TOKEN_BYTECODE,
    wallet
  );
  const mETH = await mETHFactory.deploy("Mock ETH", "mETH");
  await mETH.waitForDeployment();
  const mETHAddress = await mETH.getAddress();
  console.log('   ‚úÖ mETH deployed:', mETHAddress);

  // Deploy mUSDC
  console.log('2Ô∏è‚É£  Deploying mUSDC...');
  const mUSDCFactory = new ethers.ContractFactory(
    ["constructor(string memory name, string memory symbol)"],
    MOCK_TOKEN_BYTECODE,
    wallet
  );
  const mUSDC = await mUSDCFactory.deploy("Mock USDC", "mUSDC");
  await mUSDC.waitForDeployment();
  const mUSDCAddress = await mUSDC.getAddress();
  console.log('   ‚úÖ mUSDC deployed:', mUSDCAddress);

  // Sort tokens (token0 < token1)
  const [token0, token1] = mETHAddress.toLowerCase() < mUSDCAddress.toLowerCase()
    ? [mETHAddress, mUSDCAddress]
    : [mUSDCAddress, mETHAddress];

  console.log('');
  console.log('‚ïê'.repeat(60));
  console.log('üìã Deployment Summary');
  console.log('‚ïê'.repeat(60));
  console.log('mETH:  ', mETHAddress);
  console.log('mUSDC: ', mUSDCAddress);
  console.log('');
  console.log('Token0:', token0);
  console.log('Token1:', token1);
  console.log('');
  console.log('üîß Update your .env with:');
  console.log(`TOKEN_A_ADDRESS=${mETHAddress}`);
  console.log(`TOKEN_B_ADDRESS=${mUSDCAddress}`);
  console.log('');
  console.log('üìä Explorer links:');
  console.log(`mETH:  https://sepolia.uniscan.xyz/address/${mETHAddress}`);
  console.log(`mUSDC: https://sepolia.uniscan.xyz/address/${mUSDCAddress}`);
}

main().catch(console.error);
